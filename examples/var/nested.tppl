function flip(p) {
  sample(bernoulli(p))
}
// 3.16 gives optimal variance for SMC for this model.
a1 = log(3.16227766) // sqrt((2^2+4^2)/2)
a2 = log(6.00)

w1 = log(1)
w2 = log(2)
w3 = log(4)

w4 = log(2)
w5 = log(6)

if flip(0.5) then {
  weight(w1+a1)
  resample()
  if flip(0.5) then {
    weight(w2-a1)
  } else {
    weight(w3-a1)
  }
} else {
  weight(w4+a2)
  resample()
  weight(w5-a2)
}
